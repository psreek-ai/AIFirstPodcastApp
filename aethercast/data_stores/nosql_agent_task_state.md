# NoSQL Data Store: AgentTaskState Collection

## Purpose
Stores the state of tasks being processed by the various AI agents in the system. This allows for tracking, resuming, and debugging agent workflows.

## Schema
```json
{
  "task_id": "string", // Unique identifier for the task
  "agent_name": "string", // Name of the agent processing this task (e.g., "SnippetCraftAgent", "PodcastScriptWeaverAgent", "VoiceForgeAgent")
  "triggering_event_id": "string", // ID of the event that triggered this task (e.g., API request ID, previous task ID)
  "input_parameters": { // Parameters provided to the agent for this task
    "topic_id": "string", // (Optional)
    "snippet_id_source": "string", // (Optional)
    "podcast_script_id": "string" // (Optional)
    // ... other agent-specific parameters
  },
  "status": "string", // e.g., "pending", "in_progress", "awaiting_dependency", "completed", "failed", "retrying"
  "progress_percentage": "integer", // Estimated progress (0-100)
  "current_step": "string", // Description of the current processing step
  "attempts": "integer", // Number of times this task has been attempted
  "last_error": { // Information about the last error, if any
    "timestamp": "timestamp",
    "message": "string",
    "details": "string" // e.g., stack trace or more detailed error info
  },
  "output_references": { // References to outputs generated by this task
    "snippet_id_generated": "string", // (Optional)
    "podcast_script_id_generated": "string", // (Optional)
    "audio_artifact_id": "string" // (Optional)
  },
  "dependencies": [ // List of task_ids that this task depends on
    {
      "task_id": "string",
      "status_expected": "string" // e.g., "completed"
    }
  ],
  "created_at": "timestamp",
  "updated_at": "timestamp",
  "expires_at": "timestamp" // Optional: for tasks that should eventually time out
}
```

## Indexes
- `task_id` (Primary Key)
- `agent_name`
- `status`
- `created_at`
- `triggering_event_id`

## Example
```json
{
  "task_id": "task_agent_snippet_abc123",
  "agent_name": "SnippetCraftAgent",
  "triggering_event_id": "api_req_xyz789",
  "input_parameters": {
    "topic_id": "tech_ai_ethics"
  },
  "status": "in_progress",
  "progress_percentage": 40,
  "current_step": "Querying LLM for snippet text",
  "attempts": 1,
  "last_error": null,
  "output_references": {},
  "dependencies": [],
  "created_at": "2023-10-26T14:00:00Z",
  "updated_at": "2023-10-26T14:05:00Z"
}
```
